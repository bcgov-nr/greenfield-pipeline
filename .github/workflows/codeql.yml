# For most projects, this workflow file will not need changing; you simply need
# to commit it to your repository.
#
# You may wish to alter this file to override the set of languages analyzed,
# or to provide custom queries or build logic.
#
# ******** NOTE ********
# We have attempted to detect the languages in your repository. Please check
# the `language` matrix defined below to confirm you have the correct set of
# supported CodeQL languages.
#
name: "CodeQL"

on:
  push:
    branches: ["main"]
  pull_request:
    # The branches below must be a subset of the branches above
    branches: ["main"]
  schedule:
    - cron: "0 12 * * 0" # 4 AM PST = 12 PM UDT, runs sundays

jobs:
  # go:
  #   name: Go
  #   runs-on: ubuntu-22.04
  #   steps:
  #     - uses: actions/checkout@v4

  #     - name: Initialize CodeQL
  #       uses: github/codeql-action/init@v2
  #       with:
  #         languages: go

  #     - name: Go Build
  #       working-directory: backend-go
  #       run: |
  #         sed -i '/^toolchain .*$/d' go.mod
  #         go install github.com/swaggo/swag/cmd/swag@latest
  #         CGO_ENABLED=0 GOOS=linux go build -v

  #     - name: Perform CodeQL Analysis
  #       uses: github/codeql-action/analyze@v2
  #       with:
  #         category: "/language:go"

  # java:
  #   name: Java
  #   runs-on: ubuntu-22.04
  #   steps:
  #     - uses: actions/checkout@v4

  #     - name: Initialize CodeQL
  #       uses: github/codeql-action/init@v2
  #       with:
  #         languages: java

  #     - uses: actions/setup-java@v3
  #       with:
  #         distribution: "temurin"
  #         java-version: "17"

  #     - name: Cache local Maven repository
  #       uses: actions/cache@v3
  #       with:
  #         path: ~/.m2/repository
  #         key: ${{ runner.os }}-maven-${{ hashFiles('**/pom.xml') }}
  #         restore-keys: |
  #           ${{ runner.os }}-maven-

  #     - name: Java Build
  #       working-directory: backend-java
  #       run: |
  #         ./mvnw package -Pnative -DskipTests

  #     - name: Perform CodeQL Analysis
  #       uses: github/codeql-action/analyze@v2
  #       with:
  #         working-directory: backend-java
  #         category: "/language:java"

  CodeQL:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: false
      matrix:
        # language: ["java", "javascript", "python"]
        include:
          - language: "java"
            build: |
              cd backend-java
              ./mvnw package -Pnative -DskipTests
          # - language: "javascript"
          # - language: "python"
    steps:
      - uses: actions/checkout@v4
      - uses: github/codeql-action/init@v2
        with:
          languages: ${{ matrix.language }}

      - name: Autobuild
        if: ${{ ! matrix.build }}
        uses: github/codeql-action/autobuild@v2

      - uses: actions/setup-java@v3
        if: ${{ matrix.build && matrix.language == 'java' }}
        with:
          distribution: "temurin"
          java-version: "17"

      - name: Build
        if: ${{ matrix.build }}
        run: ${{ matrix.build }}

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2
        with:
          category: "/language:${{matrix.language}}"
